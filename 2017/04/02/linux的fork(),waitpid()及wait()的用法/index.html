<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="b0lv42" />



<meta name="description" content="其实是操作系统的作业...搬运了一些资料过来！">
<meta property="og:type" content="article">
<meta property="og:title" content="linux的fork(),waitpid()及wait()的用法">
<meta property="og:url" content="https://b0lv42.github.io/2017/04/02/linux的fork(),waitpid()及wait()的用法/index.html">
<meta property="og:site_name" content="b0lv42'blog - 不断探索!">
<meta property="og:description" content="其实是操作系统的作业...搬运了一些资料过来！">
<meta property="og:image" content="http://img.blog.csdn.net/20170323221008483?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQm9sdmFy/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170323221311375?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQm9sdmFy/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170323221348470?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQm9sdmFy/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:updated_time" content="2017-04-02T10:11:11.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="linux的fork(),waitpid()及wait()的用法">
<meta name="twitter:description" content="其实是操作系统的作业...搬运了一些资料过来！">
<meta name="twitter:image" content="http://img.blog.csdn.net/20170323221008483?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQm9sdmFy/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">




    <link rel="shortcut icon" href="/healthy_bin_cat_128px_547395_easyicon.net.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/black/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>linux的fork(),waitpid()及wait()的用法 | b0lv42&#39;blog - 不断探索!</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/头像.jpeg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">b0lv42</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="true" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="https://myaccount.google.com/?utm_source=OGB" title="Email"></a>
                            
                                <a class="fa 知乎" href="https://www.zhihu.com/people/liu-yiguo-75/activities" title="知乎"></a>
                            
                                <a class="fa GitHub" href="https://github.com/b0lv42" title="GitHub"></a>
                            
                                <a class="fa 网易云音乐" href="http://music.163.com/#/user/home?id=41091447" title="网易云音乐"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ACM题解/">ACM题解</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/收集的乱七八糟的东西！/">收集的乱七八糟的东西！</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/零零碎碎的知识！/">零零碎碎的知识！</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="http://acdoge.com/">Doge</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">喵！喵喵喵！</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">b0lv42</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/头像.jpeg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">b0lv42</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="https://myaccount.google.com/?utm_source=OGB" title="Email"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/liu-yiguo-75/activities" title="知乎"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/b0lv42" title="GitHub"></a>
                            
                                <a class="fa 网易云音乐" target="_blank" href="http://music.163.com/#/user/home?id=41091447" title="网易云音乐"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-linux的fork(),waitpid()及wait()的用法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/04/02/linux的fork(),waitpid()及wait()的用法/" class="article-date">
      <time datetime="2017-04-02T09:45:36.583Z" itemprop="datePublished">2017-04-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      linux的fork(),waitpid()及wait()的用法
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/零零碎碎的知识！/">零零碎碎的知识！</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="这个是作业！更新写在前面！"><a href="#这个是作业！更新写在前面！" class="headerlink" title="这个是作业！更新写在前面！"></a>这个是作业！更新写在前面！</h1><h2 id="waitpid-及wait-原文地址"><a href="#waitpid-及wait-原文地址" class="headerlink" title="waitpid()及wait() 原文地址"></a><a href="http://www.2cto.com/os/201203/124851.html" target="_blank" rel="external">waitpid()及wait() 原文地址</a></h2><h2 id="fork-原文地址"><a href="#fork-原文地址" class="headerlink" title="fork() 原文地址"></a><a href="http://m.blog.csdn.net/article/details?id=5640969" target="_blank" rel="external">fork() 原文地址</a></h2><p>试了下一个小程序：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/wait.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;<span class="comment">/* 如果是子进程 */</span><span class="comment">/* 在这里等待 */</span> <span class="comment">/* 如果是父进程 */</span>   </div><div class="line">        pc=fork();</div><div class="line">        <span class="keyword">if</span>(pc==<span class="number">0</span>)     </div><div class="line">        &#123;       </div><div class="line">             <span class="built_in">printf</span>(<span class="string">"This is child process with pid of %d\n"</span>,getpid()); </div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;    </div><div class="line">             pr=wait(<span class="literal">NULL</span>); </div><div class="line">             <span class="built_in">printf</span>(<span class="string">"I catched a child process with pid of %d\n"</span>),pr); </div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(“hello1\n”);</div><div class="line">        </div><div class="line">        pc=fork();</div><div class="line">        <span class="keyword">if</span>(pc==<span class="number">0</span>)     </div><div class="line">        &#123;       </div><div class="line">             <span class="built_in">printf</span>(<span class="string">"This is child process with pid of %d\n"</span>,getpid()); </div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;    </div><div class="line">             pr=wait(<span class="literal">NULL</span>); </div><div class="line">             <span class="built_in">printf</span>(<span class="string">"I catched a child process with pid of %d\n"</span>),pr); </div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(“hello2\n”);</div><div class="line">        </div><div class="line">        pc=fork();</div><div class="line">        <span class="keyword">if</span>(pc==<span class="number">0</span>)     </div><div class="line">        &#123;       </div><div class="line">             <span class="built_in">printf</span>(<span class="string">"This is child process with pid of %d\n"</span>,getpid()); </div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;    </div><div class="line">             pr=wait(<span class="literal">NULL</span>); </div><div class="line">             <span class="built_in">printf</span>(<span class="string">"I catched a child process with pid of %d\n"</span>),pr); </div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(“hello3\n”);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是第一个fork()调用完毕后的输出：<br><img src="http://img.blog.csdn.net/20170323221008483?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQm9sdmFy/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="a 这个是第小段运行完毕时的"></p>
<p>这是第二个fork()调用完毕后的输出：<br><img src="http://img.blog.csdn.net/20170323221311375?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQm9sdmFy/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>这是第三个fork()调用完毕后的输出：<br><img src="http://img.blog.csdn.net/20170323221348470?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQm9sdmFy/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="wait-等待子进程中断或结束"><a href="#wait-等待子进程中断或结束" class="headerlink" title="wait() (等待子进程中断或结束)"></a>wait() (等待子进程中断或结束)</h1><h4 id="表头文件："><a href="#表头文件：" class="headerlink" title="表头文件："></a>表头文件：</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/wait.h&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="定义函数："><a href="#定义函数：" class="headerlink" title="定义函数："></a>定义函数：</h4><p> <code>pid_t wait (int * status);</code></p>
<h4 id="函数说明："><a href="#函数说明：" class="headerlink" title="函数说明："></a>函数说明：</h4><pre><code>wait()会暂时停止目前进程的执行,直到有信号来到或子进程结束。
如果在调用 wait()时子进程已经结束,则 wait()会立即返回子进程结束状态值。
子进程的结束状态值会由参数 status 返回,而子进程的进程识别码也会一起返回。

如果不在意结束状态值,则参数 status 可以设成 NULL。
子进程的结束状态值请参考 waitpid( )     
如果执行成功则返回子进程识别码(PID) ,如果有错误发生则返回返回值-1。失败原因存于 errno 中。
</code></pre><blockquote>
<p>pid_t  pid1;<br>int status=0;<br>i=wait(&amp;status);</p>
</blockquote>
<p>i返回的是子进程的识别码 PID<br>status中存的是子进程的结束状态；可用WEXITSTATUS（status）得到子进程的exit(3)的状态，那么就是3；</p>
<p> <br><br> <br></p>
<h1 id="waitpid-等待子进程中断或结束"><a href="#waitpid-等待子进程中断或结束" class="headerlink" title="waitpid() (等待子进程中断或结束)"></a>waitpid() (等待子进程中断或结束)</h1><h4 id="表头文件：-1"><a href="#表头文件：-1" class="headerlink" title="表头文件："></a>表头文件：</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/wait.h&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="定义函数：-1"><a href="#定义函数：-1" class="headerlink" title="定义函数："></a>定义函数：</h4><p> <code>pid_t waitpid(pid_t pid,int * status,int options);</code></p>
<h4 id="函数说明：-1"><a href="#函数说明：-1" class="headerlink" title="函数说明："></a>函数说明：</h4><pre><code>waitpid()会暂时停止目前进程的执行,直到有信号来到或子进程结束。

如果在调用 wait()时子进程已经结束,则 wait()会立即返回子进程结束状态值。
子进程的结束状态值会由参数 status 返回,而子进程的进程识别码也会一快返回。
如果不在意结束状态值,则参数 status 可以设成 NULL。

参数 pid 为欲等待的子进程识别码,其他数值意义如下:
 pid&lt;-1 等待进程组识别码为 pid 绝对值的任何子进程。
 pid=-1 等待任何子进程,相当于 wait()。            
 pid=0     等待进程组识别码与目前进程相同的任何子进程。       
 pid&gt;0     等待任何子进程识别码为 pid 的子进程。

参数 option 可以为 0 或下面的 OR 组合:
WNOHANG 如果没有任何已经结束的子进程则马上返回, 不予以等待。
WUNTRACED 如果子进程进入暂停执行情况则马上返回,但结束状态不予以理会。

子进程的结束状态返回后存于 status,底下有几个宏可判别结束情况:
WIFEXITED(status)如果子进程正常结束则为非 0 值。
WEXITSTATUS(status)取得子进程 exit()返回的结束代码,一般会先用 WIFEXITED 来判断是否正常结束才能使用此宏。
WIFSIGNALED(status)如果子进程是因为信号而结束则此宏值为真
WTERMSIG(status) 取得子进程因信号而中止的信号代码,一般会先用 WIFSIGNALED 来判断后才使用此宏。
WIFSTOPPED(status) 如果子进程处于暂停执行情况则此宏值为真。一般只有使用 WUNTRACED 时才会有此情况。
WSTOPSIG(status) 取得引发子进程暂停的信号代码,一般会先用 WIFSTOPPED 来判断后才使用此宏。
如果执行成功则返回子进程识别码(PID) ,如果有错误发生则返回返回值-1。失败原因存于 errno 中。
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">pid_t</span> childpid;</div><div class="line">    <span class="keyword">int</span> status;</div><div class="line">    </div><div class="line">    childpid = fork();</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ( <span class="number">-1</span> == childpid )</div><div class="line">    &#123;</div><div class="line">        perror( <span class="string">"fork()"</span> );</div><div class="line">        <span class="built_in">exit</span>( EXIT_FAILURE );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="number">0</span> == childpid )</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">puts</span>( <span class="string">"In child process"</span> );</div><div class="line">        sleep( <span class="number">3</span> );<span class="comment">//让子进程睡眠3秒，看看父进程的行为</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"\tchild pid = %d\n"</span>, getpid());</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"\tchild ppid = %d\n"</span>, getppid());</div><div class="line">        <span class="built_in">exit</span>(EXIT_SUCCESS);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> </div><div class="line">    &#123;</div><div class="line">        waitpid( childpid, &amp;status, <span class="number">0</span> );</div><div class="line">        <span class="built_in">puts</span>( <span class="string">"in parent"</span> );</div><div class="line">        <span class="built_in">printf</span>( <span class="string">"\tparent pid = %d\n"</span>, getpid() );</div><div class="line">        <span class="built_in">printf</span>( <span class="string">"\tparent ppid = %d\n"</span>, getppid()  );</div><div class="line">        <span class="built_in">printf</span>( <span class="string">"\tchild process exited with status %d \n"</span>, status );</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">exit</span>(EXIT_SUCCESS);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost src]<span class="meta"># gcc waitpid.c </span></div><div class="line">[root@localhost src]# ./a.out </div><div class="line">In child process</div><div class="line">        child pid = <span class="number">4469</span></div><div class="line">        child ppid = <span class="number">4468</span></div><div class="line">in parent</div><div class="line">        parent pid = <span class="number">4468</span></div><div class="line">        parent ppid = <span class="number">4379</span></div><div class="line">        child process exited with status <span class="number">0</span> </div><div class="line">[root@localhost src]#</div></pre></td></tr></table></figure>
<h5 id="如果将上面“waitpid-childpid-amp-status-0-”行注释掉，程序执行效果如下："><a href="#如果将上面“waitpid-childpid-amp-status-0-”行注释掉，程序执行效果如下：" class="headerlink" title="如果将上面“waitpid( childpid, &amp;status, 0 );”行注释掉，程序执行效果如下："></a>如果将上面“waitpid( childpid, &amp;status, 0 );”行注释掉，程序执行效果如下：</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost src]# ./a.out </div><div class="line">In child process</div><div class="line">in parent</div><div class="line">        parent pid = <span class="number">4481</span></div><div class="line">        parent ppid = <span class="number">4379</span></div><div class="line">        child process exited with status <span class="number">1331234400</span> </div><div class="line">[root@localhost src]#   child pid = <span class="number">4482</span></div><div class="line">        child ppid = <span class="number">1</span></div></pre></td></tr></table></figure>
<p>子进程还没有退出，父进程已经退出了。</p>
<h1 id="fork"><a href="#fork" class="headerlink" title="fork()"></a>fork()</h1><h2 id="fork入门知识"><a href="#fork入门知识" class="headerlink" title="fork入门知识"></a>fork入门知识</h2><pre><code> 一个进程，包括代码、数据和分配给进程的资源。fork（）函数通过系统调用创建一个与原来进程几乎完全相同的进程，也就是两个进程可以做完全相同的事，但如果初始参数或者传入的变量不同，两个进程也可以做不同的事。
一个进程调用fork（）函数后，系统先给新的进程分配资源，例如存储数据和代码的空间。然后把原来的进程的所有值都复制到新的新进程中，只有少数值与原来的进程的值不同。相当于克隆了一个自己。
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span></div><div class="line">&#123; </div><div class="line">	<span class="keyword">pid_t</span> fpid; <span class="comment">//fpid表示fork函数返回的值</span></div><div class="line">	<span class="keyword">int</span> count=<span class="number">0</span>;</div><div class="line">	fpid=fork(); </div><div class="line">	<span class="keyword">if</span> (fpid &lt; <span class="number">0</span>) </div><div class="line">		<span class="built_in">printf</span>(<span class="string">"error in fork!"</span>); </div><div class="line">	<span class="keyword">else</span> </div><div class="line">    <span class="keyword">if</span> (fpid == <span class="number">0</span>) </div><div class="line">    &#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"i am the child process, my process id is %d/n"</span>,getpid()); </div><div class="line">		<span class="built_in">printf</span>(<span class="string">"我是爹的儿子/n"</span>);<span class="comment">//对某些人来说中文看着更直白。</span></div><div class="line">		count++;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> </div><div class="line">    &#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"i am the parent process, my process id is %d/n"</span>,getpid()); </div><div class="line">		<span class="built_in">printf</span>(<span class="string">"我是孩子他爹/n"</span>);</div><div class="line">		count++;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"统计结果是: %d/n"</span>,count);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>运行结果是：
</code></pre><blockquote>
<p>i am the child process, my process id is 5574<br>我是爹的儿子<br>统计结果是: 1<br>i am the parent process, my process id is 5573<br>我是孩子他爹<br>统计结果是: 1</p>
</blockquote>
<pre><code>在语句fpid=fork()之前，只有一个进程在执行这段代码，但在这条语句之后，就变成两个进程在执行了，这两个进程的几乎完全相同，将要执行的下一条语句都是if(fpid&lt;0)……
为什么两个进程的fpid不同呢，这与fork函数的特性有关。fork调用的一个奇妙之处就是它仅仅被调用一次，却能够返回两次，它可能有三种不同的返回值：
1）在父进程中，fork返回新创建子进程的进程ID；
2）在子进程中，fork返回0；
3）如果出现错误，fork返回一个负值；

在fork函数执行完毕后，如果创建新进程成功，则出现两个进程，一个是子进程，一个是父进程。在子进程中，fork函数返回0，在父进程中，fork返回新创建子进程的进程ID。我们可以通过fork返回的值来判断当前进程是子进程还是父进程。

引用一位网友的话来解释fpid的值为什么在父子进程中不同。“其实就相当于链表，进程形成了链表，父进程的fpid(p 意味point)指向子进程的进程id, 因为子进程没有子进程，所以其fpid为0.
fork出错可能有两种原因：
1）当前的进程数已经达到了系统规定的上限，这时errno的值被设置为EAGAIN。
2）系统内存不足，这时errno的值被设置为ENOMEM。
创建新进程成功后，系统中出现两个基本完全相同的进程，这两个进程执行没有固定的先后顺序，哪个进程先执行要看系统的进程调度策略。
每个进程都有一个独特（互不相同）的进程标识符（process ID），可以通过getpid（）函数获得，还有一个记录父进程pid的变量，可以通过getppid（）函数获得变量的值。
fork执行完毕后，出现两个进程，

有人说两个进程的内容完全一样啊，怎么打印的结果不一样啊，那是因为判断条件的原因，上面列举的只是进程的代码和指令，还有变量啊。
执行完fork后，进程1的变量为count=0，fpid！=0（父进程）。进程2的变量为count=0，fpid=0（子进程），这两个进程的变量都是独立的，存在不同的地址中，不是共用的，这点要注意。可以说，我们就是通过fpid来识别和操作父子进程的。
还有人可能疑惑为什么不是从#include处开始复制代码的，这是因为fork是把进程当前的情况拷贝一份，执行fork时，进程已经执行完了int count=0;fork只拷贝下一个要执行的代码到新的进程。
</code></pre><h2 id="fork进阶知识"><a href="#fork进阶知识" class="headerlink" title="fork进阶知识"></a>fork进阶知识</h2><h3 id="代码1："><a href="#代码1：" class="headerlink" title="代码1："></a>代码1：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">   <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">   <span class="built_in">printf</span>(<span class="string">"i son/pa ppid pid  fpid/n"</span>);</div><div class="line"></div><div class="line">   <span class="comment">//ppid指当前进程的父进程pid</span></div><div class="line">   <span class="comment">//pid指当前进程的pid,</span></div><div class="line">   <span class="comment">//fpid指fork返回给当前进程的值</span></div><div class="line"></div><div class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)</div><div class="line">   &#123;</div><div class="line">       <span class="keyword">pid_t</span> fpid=fork();</div><div class="line">       <span class="keyword">if</span> (fpid==<span class="number">0</span>)</div><div class="line">    	   <span class="built_in">printf</span>(<span class="string">"%d child  %4d %4d %4d/n"</span>,i,getppid(),getpid(),fpid);</div><div class="line">       <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d parent %4d %4d %4d/n"</span>,i,getppid(),getpid(),fpid);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line">``` </div><div class="line">    运行结果是：</div><div class="line">&gt;    i son/pa ppid pid  fpid</div><div class="line">&gt;    <span class="number">0</span> parent <span class="number">2043</span> <span class="number">3224</span> <span class="number">3225</span></div><div class="line">&gt;    <span class="number">0</span> child  <span class="number">3224</span> <span class="number">3225</span>    <span class="number">0</span></div><div class="line">&gt;    <span class="number">1</span> parent <span class="number">2043</span> <span class="number">3224</span> <span class="number">3226</span></div><div class="line">&gt;    <span class="number">1</span> parent <span class="number">3224</span> <span class="number">3225</span> <span class="number">3227</span></div><div class="line">&gt;    <span class="number">1</span> child     <span class="number">1</span> <span class="number">3227</span>    <span class="number">0</span></div><div class="line">&gt;    <span class="number">1</span> child     <span class="number">1</span> <span class="number">3226</span>    <span class="number">0</span></div><div class="line"></div><div class="line">#### 第一步：</div><div class="line">    在父进程中，指令执行到<span class="keyword">for</span>循环中，i=<span class="number">0</span>，接着执行fork，fork执行完后，系统中出现两个进程，分别是p3224和p3225（后面我都用pxxxx表示进程id为xxxx的进程）。可以看到父进程p3224的父进程是p2043，子进程p3225的父进程正好是p3224。我们用一个链表来表示这个关系：</div><div class="line">    p2043-&gt;p3224-&gt;p3225</div><div class="line">    第一次fork后，p3224（父进程）的变量为i=<span class="number">0</span>，fpid=<span class="number">3225</span>（fork函数在父进程中返向子进程id），代码内容为：</div><div class="line"></div><div class="line">``` C++</div><div class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)</div><div class="line">   &#123;</div><div class="line">       <span class="keyword">pid_t</span> fpid=fork();<span class="comment">//执行完毕，i=0，fpid=3225</span></div><div class="line">       <span class="keyword">if</span> (fpid==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"%d child  %4d %4d %4d/n"</span>,i,getppid(),getpid(),fpid);</div><div class="line">       <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d parent %4d %4d %4d/n"</span>,i,getppid(),getpid(),fpid);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="number">0</span>;</div></pre></td></tr></table></figure>
<pre><code>p3225（子进程）的变量为i=0，fpid=0（fork函数在子进程中返回0）
代码内容为：    
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)</div><div class="line"> &#123;</div><div class="line">    <span class="keyword">pid_t</span> fpid=fork();                         <span class="comment">//执行完毕，i=0，fpid=0</span></div><div class="line">    <span class="keyword">if</span> (fpid==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"%d child  %4d %4d %4d/n"</span>,i,getppid(),getpid(),fpid);</div><div class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d parent %4d %4d %4d/n"</span>,i,getppid(),getpid(),fpid);</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div></pre></td></tr></table></figure>
<pre><code>所以打印出结果：
</code></pre><blockquote>
<p>   0 parent 2043 3224 3225<br>   0 child  3224 3225    0</p>
</blockquote>
<h4 id="第二步："><a href="#第二步：" class="headerlink" title="第二步："></a>第二步：</h4><pre><code>假设父进程p3224先执行，当进入下一个循环时，i=1，接着执行fork，系统中又新增一个进程p3226，对于此时的父进程，p2043-&gt;p3224（当前进程）-&gt;p3226（被创建的子进程）。
对于子进程p3225，执行完第一次循环后，i=1，接着执行fork，系统中新增一个进程p3227，对于此进程，p3224-&gt;p3225（当前进程）-&gt;p3227（被创建的子进程）。从输出可以看到p3225原来是p3224的子进程，现在变成p3227的父进程。父子是相对的，这个大家应该容易理解。只要当前进程执行了fork，该进程就变成了父进程了，就打印出了parent。
所以打印出结果是：
</code></pre><blockquote>
<p> 1 parent 2043 3224 3226<br> 1 parent 3224 3225 3227</p>
</blockquote>
<h4 id="第三步："><a href="#第三步：" class="headerlink" title="第三步："></a>第三步：</h4><pre><code>第二步创建了两个进程p3226，p3227，这两个进程执行完printf函数后就结束了，因为这两个进程无法进入第三次循环，无法fork，该执行return 0;了，其他进程也是如此。
以下是p3226，p3227打印出的结果：
</code></pre><blockquote>
<p>1 child     1 3227    0<br>1 child     1 3226    0<br>    细心的读者可能注意到p3226，p3227的父进程难道不该是p3224和p3225吗，怎么会是1呢？这里得讲到进程的创建和死亡的过程，在p3224和p3225执行完第二个循环后，main函数就该退出了，也即进程该死亡了，因为它已经做完所有事情了。p3224和p3225死亡后，p3226，p3227就没有父进程了，这在操作系统是不被允许的，所以p3226，p3227的父进程就被置为p1了，p1是永远不会死亡的。</p>
</blockquote>
<pre><code>总结一下，这个程序执行的流程如下：
这个程序最终产生了3个子进程，执行过6次printf（）函数。
</code></pre><h3 id="代码2："><a href="#代码2：" class="headerlink" title="代码2："></a>代码2：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">   <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</div><div class="line">   &#123;</div><div class="line">       <span class="keyword">pid_t</span> fpid=fork();</div><div class="line">       <span class="keyword">if</span> (fpid==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"son/n"</span>);</div><div class="line">       <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"father/n"</span>);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>它的执行结果是：
</code></pre><blockquote>
<p>  father<br>  son<br>  father<br>  father<br>  father<br>  father<br>  son<br>  son<br>  father<br>  son<br>  son<br>  son<br>  father<br>  son</p>
</blockquote>
<pre><code>分析：
for        i=0         1           2
          father     father     father
                                    son
                        son       father
                                    son
           son       father     father
                                    son
                        son       father
                                    son
其中每一行分别代表一个进程的运行打印结果。
总结一下规律，对于这种N次循环的情况，执行printf函数的次数为2*（1+2+4+……+2N-1）次，创建的子进程数为1+2+4+……+2N-1个。

数学推理见http://202.117.3.13/wordpress/?p=81（该博文的最后）。
如果想测一下一个程序中到底创建了几个子进程，最好的方法就是调用printf函数打印该进程的pid，也即调用printf(&quot;%d/n&quot;,getpid());
或者通过printf(&quot;+/n&quot;);来判断产生了几个进程。有人想通过调用printf(&quot;+&quot;)来统计创建了几个进程，这是不妥当的。
老规矩，大家看一下下面的代码：
</code></pre><h3 id="代码3："><a href="#代码3：" class="headerlink" title="代码3："></a>代码3：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">pid_t</span> fpid;     <span class="comment">//fpid表示fork函数返回的值</span></div><div class="line">	<span class="comment">//printf("fork!");</span></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"fork!/n"</span>);</div><div class="line">	fpid = fork();</div><div class="line">	<span class="keyword">if</span> (fpid &lt; <span class="number">0</span>)</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"error in fork!"</span>);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (fpid == <span class="number">0</span>)</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"I am the child process, my process id is %d/n"</span>, getpid());</div><div class="line">	<span class="keyword">else</span></div><div class="line">		<span class="built_in">printf</span>(<span class="string">"I am the parent process, my process id is %d/n"</span>, getpid());</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>执行结果如下：
</code></pre><blockquote>
<p>  fork!<br>  I am the parent process, my process id is 3361<br>  I am the child process, my process id is 3362</p>
</blockquote>
<pre><code>如果把语句printf(&quot;fork!/n&quot;);注释掉，执行printf(&quot;fork!&quot;);
则新的程序的执行结果是：
</code></pre><blockquote>
<p>  fork!I am the parent process, my process id is 3298<br>  fork!I am the child process, my process id is 3299</p>
</blockquote>
<pre><code>程序的唯一的区别就在于一个/n回车符号，为什么结果会相差这么大呢？
这就跟printf的缓冲机制有关了，printf某些内容时，操作系统仅仅是把该内容放到了stdout的缓冲队列里了,并没有实际的写到屏幕上。但是,只要看到有/n 则会立即刷新stdout,因此就马上能够打印了。
运行了printf(&quot;fork!&quot;)后,“fork!”仅仅被放到了缓冲里,程序运行到fork时缓冲里面的“fork!” 被子进程复制过去了。
因此在子进程度stdout缓冲里面就也有了fork!。所以,你最终看到的会是&quot;fork!&quot;被printf了2次！
而运行printf(&quot;fork! /n&quot;)后,“fork!”被立即打印到了屏幕上,之后fork到的子进程里的stdout缓冲里不会有fork! 内容。因此你看到的结果会是fork! 被printf了1次！
所以说printf(&quot;+&quot;);不能正确地反应进程的数量。
</code></pre><h3 id="代码4："><a href="#代码4：" class="headerlink" title="代码4："></a>代码4：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">   fork();</div><div class="line">   fork() &amp;&amp; fork() || fork();</div><div class="line">   fork();</div><div class="line">   <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>问题是不算main这个进程自身，程序到底创建了多少个进程。
为了解答这个问题，我们先做一下弊，先用程序验证一下，到此有多少个进程。 
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">   fork();</div><div class="line">   fork() &amp;&amp; fork() || fork();</div><div class="line">   fork();</div><div class="line">   <span class="built_in">printf</span>(<span class="string">"+/n"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>总共20个进程，除去main进程，还有19个进程。
第一个fork和最后一个fork肯定是会执行的。
主要在中间3个fork上，可以画一个图进行描述。
这里就需要注意&amp;&amp;和||运算符。
A&amp;&amp;B，如果A==0，就没有必要继续执行&amp;&amp;B了；A非0，就需要继续执行&amp;&amp;B。
A||B，如果A非0，就没有必要继续执行||B了，A=0，就需要继续执行||B。
fork()对于父进程和子进程的返回值是不同的，按照上面的A&amp;&amp;B和A||B的分支进行画图，可以得出5个分支。

加上前面的fork和最后的fork，总共4*5=20个进程，除去main主进程，就是19个进程了。
</code></pre><h2 id="fork高阶知识"><a href="#fork高阶知识" class="headerlink" title="fork高阶知识"></a>fork高阶知识</h2><pre><code>就fork函数讲一下操作系统进程的创建、死亡和调度等。
</code></pre>
      
    </div>
    
  </div>
  
    


    <nav id="article-nav">
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2017/04/01/hello-world/">
                    喵喵喵！
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#这个是作业！更新写在前面！"><span class="toc-number">1.</span> <span class="toc-text">这个是作业！更新写在前面！</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#waitpid-及wait-原文地址"><span class="toc-number">1.1.</span> <span class="toc-text">waitpid()及wait() 原文地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fork-原文地址"><span class="toc-number">1.2.</span> <span class="toc-text">fork() 原文地址</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wait-等待子进程中断或结束"><span class="toc-number">2.</span> <span class="toc-text">wait() (等待子进程中断或结束)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#表头文件："><span class="toc-number">2.0.0.1.</span> <span class="toc-text">表头文件：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义函数："><span class="toc-number">2.0.0.2.</span> <span class="toc-text">定义函数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#函数说明："><span class="toc-number">2.0.0.3.</span> <span class="toc-text">函数说明：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#waitpid-等待子进程中断或结束"><span class="toc-number">3.</span> <span class="toc-text">waitpid() (等待子进程中断或结束)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#表头文件：-1"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">表头文件：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义函数：-1"><span class="toc-number">3.0.0.2.</span> <span class="toc-text">定义函数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#函数说明：-1"><span class="toc-number">3.0.0.3.</span> <span class="toc-text">函数说明：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#如果将上面“waitpid-childpid-amp-status-0-”行注释掉，程序执行效果如下："><span class="toc-number">3.0.0.3.1.</span> <span class="toc-text">如果将上面“waitpid( childpid, &status, 0 );”行注释掉，程序执行效果如下：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fork"><span class="toc-number">4.</span> <span class="toc-text">fork()</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#fork入门知识"><span class="toc-number">4.1.</span> <span class="toc-text">fork入门知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fork进阶知识"><span class="toc-number">4.2.</span> <span class="toc-text">fork进阶知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码1："><span class="toc-number">4.2.1.</span> <span class="toc-text">代码1：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#第二步："><span class="toc-number">4.2.1.1.</span> <span class="toc-text">第二步：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第三步："><span class="toc-number">4.2.1.2.</span> <span class="toc-text">第三步：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码2："><span class="toc-number">4.2.2.</span> <span class="toc-text">代码2：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码3："><span class="toc-number">4.2.3.</span> <span class="toc-text">代码3：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码4："><span class="toc-number">4.2.4.</span> <span class="toc-text">代码4：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fork高阶知识"><span class="toc-number">4.3.</span> <span class="toc-text">fork高阶知识</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"linux的fork(),waitpid()及wait()的用法　| b0lv42'blog - 不断探索!　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2017/04/01/hello-world/" title="下一篇: 喵喵喵！">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/02/linux的fork(),waitpid()及wait()的用法/">linux的fork(),waitpid()及wait()的用法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/01/hello-world/">喵喵喵！</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/HDOJ 2500 【简单题】做一个正气的杭电人/">HDOJ 2500 【简单题】做一个正气的杭电人</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/HDOJ 3790 【Dijkstra】最短路径问题/">HDOJ 3790 【Dijkstra】最短路径问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/HDOJ 2544 【Dijkstra】最短路/">HDOJ 2544 【Dijkstra】最短路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/10/HDOJ 2066 【Dijkstra】一个人的旅行/">HDOJ 2066 【Dijkstra】一个人的旅行</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/09/HDOJ 1874 【FLoyd】【Bellman】畅通工程续/">HDOJ 1874 【FLoyd】【Bellman】【Dijkstra】畅通工程续</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/08/HDOJ 1215 【简单题】七夕节  &  HDOJ 1406 【简单题】完数/">HDOJ 1215 【简单题】七夕节  &  HDOJ 1406 【简单题】完数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/06/HDOJ 1217 【Floyd】Arbitrage/">HDOJ 1217 【Floyd】Arbitrage</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/05/HDOJ 1869 【Floyd】六度分离/">HDOJ 1869 【Floyd】六度分离</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/04/HDOJ 1290 【递推】献给杭电五十周年校庆的礼物/">HDOJ 1290 【递推】献给杭电五十周年校庆的礼物</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/03/HDOJ 1051 【贪心】 Wooden Sticks/">HDOJ 1051 【贪心】 Wooden Sticks</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/02/HDOJ 1098 【数学题】Ignatius's puzzle/">HDOJ 1098 【数学题】Ignatius's puzzle</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2017 b0lv42
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 23;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
             post: ".article-entry a[href], .copyright a[href]", 
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>